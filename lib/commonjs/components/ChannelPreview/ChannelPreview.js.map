{"version":3,"sources":["ChannelPreview.tsx"],"names":["UnMemoizedChannelPreview","props","channel","Preview","ChannelPreviewMessenger","client","lastMessage","setLastMessage","countUnread","unread","setUnread","latestMessagePreview","handleEvent","event","message","type","on","off","handleReadEvent","user","id","userID","areEqual","prevProps","nextProps","previousLast","state","last_message_at","nextLast","ChannelPreview","React","memo"],"mappings":";;;;;;;;;;;;;AAAA;;AAEA;;AACA;;AAEA;;;;AAwCA,IAAMA,wBAAwB,GAAG,SAA3BA,wBAA2B,CAS/BC,KAT+B,EAU5B;AAAA,MACKC,OADL,GACoDD,KADpD,CACKC,OADL;AAAA,uBACoDD,KADpD,CACcE,OADd;AAAA,MACcA,OADd,+BACwBC,gDADxB;;AAAA,wBAGgB,kCAHhB;AAAA,MAGKC,MAHL,mBAGKA,MAHL;;AAAA,kBAKmC,sBALnC;AAAA;AAAA,MAKIC,WALJ;AAAA,MAKiBC,cALjB;;AAAA,mBASyB,qBAASL,OAAO,CAACM,WAAR,EAAT,CATzB;AAAA;AAAA,MASIC,MATJ;AAAA,MASYC,SATZ;;AAWH,MAAMC,oBAAoB,GAAG,sDAAwBT,OAAxB,EAAiCI,WAAjC,CAA7B;AAEA,wBAAU,YAAM;AACd,QAAMM,WAAW,GAAG,SAAdA,WAAc,CAACC,KAAD,EAA8C;AAChE,UAAIA,KAAK,CAACC,OAAV,EAAmB;AACjBP,QAAAA,cAAc,CAACM,KAAK,CAACC,OAAP,CAAd;AACD;;AAED,UAAID,KAAK,CAACE,IAAN,KAAe,aAAnB,EAAkC;AAChCL,QAAAA,SAAS,CAACR,OAAO,CAACM,WAAR,EAAD,CAAT;AACD;AACF,KARD;;AAUAN,IAAAA,OAAO,CAACc,EAAR,CAAW,aAAX,EAA0BJ,WAA1B;AACAV,IAAAA,OAAO,CAACc,EAAR,CAAW,iBAAX,EAA8BJ,WAA9B;AACAV,IAAAA,OAAO,CAACc,EAAR,CAAW,iBAAX,EAA8BJ,WAA9B;AAEA,WAAO,YAAM;AACXV,MAAAA,OAAO,CAACe,GAAR,CAAY,aAAZ,EAA2BL,WAA3B;AACAV,MAAAA,OAAO,CAACe,GAAR,CAAY,iBAAZ,EAA+BL,WAA/B;AACAV,MAAAA,OAAO,CAACe,GAAR,CAAY,iBAAZ,EAA+BL,WAA/B;AACD,KAJD;AAKD,GApBD,EAoBG,EApBH;AAsBA,wBAAU,YAAM;AACd,QAAMM,eAAe,GAAG,SAAlBA,eAAkB,CAACL,KAAD,EAA8C;AAAA;;AACpE,UAAI,gBAAAA,KAAK,CAACM,IAAN,iCAAYC,EAAZ,MAAmBf,MAAM,CAACgB,MAA9B,EAAsC;AACpCX,QAAAA,SAAS,CAAC,CAAD,CAAT;AACD;AACF,KAJD;;AAMAR,IAAAA,OAAO,CAACc,EAAR,CAAW,cAAX,EAA2BE,eAA3B;AACA,WAAO;AAAA,aAAMhB,OAAO,CAACe,GAAR,CAAY,cAAZ,EAA4BC,eAA5B,CAAN;AAAA,KAAP;AACD,GATD,EASG,EATH;AAWA,SACE,gCAAC,OAAD,gCACMjB,KADN;AAEE,IAAA,WAAW,EAAEK,WAFf;AAGE,IAAA,oBAAoB,EAAEK,oBAHxB;AAIE,IAAA,MAAM,EAAEF,MAJV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADF;AAQD,CAhED;;AAkEA,IAAMa,QAAQ,GAAG,SAAXA,QAAW,CASfC,SATe,EAUfC,SAVe,EAWZ;AAAA,MACsBC,YADtB,GACuCF,SAAS,CAACrB,OAAV,CAAkBwB,KADzD,CACKC,eADL;AAAA,MAEsBC,QAFtB,GAEmCJ,SAAS,CAACtB,OAAV,CAAkBwB,KAFrD,CAEKC,eAFL;AAIH,SAAOF,YAAY,KAAKG,QAAxB;AACD,CAhBD;;AAkBO,IAAMC,cAAc,GAAGC,kBAAMC,IAAN,CAC5B/B,wBAD4B,EAE5BsB,QAF4B,CAAvB","sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { ChannelPreviewMessenger } from './ChannelPreviewMessenger';\nimport { useLatestMessagePreview } from './hooks/useLatestMessagePreview';\n\nimport { useChatContext } from '../../contexts/chatContext/ChatContext';\n\nimport type {\n  Channel,\n  ChannelState,\n  Event,\n  MessageResponse,\n} from 'stream-chat';\n\nimport type { ChannelListMessengerProps } from '../ChannelList/ChannelListMessenger';\nimport type {\n  DefaultAttachmentType,\n  DefaultChannelType,\n  DefaultCommandType,\n  DefaultEventType,\n  DefaultMessageType,\n  DefaultReactionType,\n  DefaultUserType,\n  UnknownType,\n} from '../../types/types';\n\nexport type ChannelPreviewProps<\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType\n> = ChannelListMessengerProps<At, Ch, Co, Ev, Me, Re, Us> & {\n  /**\n   * The previewed channel\n   */\n  channel: Channel<At, Ch, Co, Ev, Me, Re, Us>;\n};\n\n/**\n * This component manages state for the ChannelPreviewMessenger UI component and receives\n * all props from the ChannelListMessenger component.\n */\nconst UnMemoizedChannelPreview = <\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType\n>(\n  props: ChannelPreviewProps<At, Ch, Co, Ev, Me, Re, Us>,\n) => {\n  const { channel, Preview = ChannelPreviewMessenger } = props;\n\n  const { client } = useChatContext<At, Ch, Co, Ev, Me, Re, Us>();\n\n  const [lastMessage, setLastMessage] = useState<\n    | ReturnType<ChannelState<At, Ch, Co, Ev, Me, Re, Us>['messageToImmutable']>\n    | MessageResponse<At, Ch, Co, Me, Re, Us>\n  >();\n  const [unread, setUnread] = useState(channel.countUnread());\n\n  const latestMessagePreview = useLatestMessagePreview(channel, lastMessage);\n\n  useEffect(() => {\n    const handleEvent = (event: Event<At, Ch, Co, Ev, Me, Re, Us>) => {\n      if (event.message) {\n        setLastMessage(event.message);\n      }\n\n      if (event.type === 'message.new') {\n        setUnread(channel.countUnread());\n      }\n    };\n\n    channel.on('message.new', handleEvent);\n    channel.on('message.updated', handleEvent);\n    channel.on('message.deleted', handleEvent);\n\n    return () => {\n      channel.off('message.new', handleEvent);\n      channel.off('message.updated', handleEvent);\n      channel.off('message.deleted', handleEvent);\n    };\n  }, []);\n\n  useEffect(() => {\n    const handleReadEvent = (event: Event<At, Ch, Co, Ev, Me, Re, Us>) => {\n      if (event.user?.id === client.userID) {\n        setUnread(0);\n      }\n    };\n\n    channel.on('message.read', handleReadEvent);\n    return () => channel.off('message.read', handleReadEvent);\n  }, []);\n\n  return (\n    <Preview<At, Ch, Co, Ev, Me, Re, Us>\n      {...props}\n      lastMessage={lastMessage}\n      latestMessagePreview={latestMessagePreview}\n      unread={unread}\n    />\n  );\n};\n\nconst areEqual = <\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType\n>(\n  prevProps: ChannelPreviewProps<At, Ch, Co, Ev, Me, Re, Us>,\n  nextProps: ChannelPreviewProps<At, Ch, Co, Ev, Me, Re, Us>,\n) => {\n  const { last_message_at: previousLast } = prevProps.channel.state;\n  const { last_message_at: nextLast } = nextProps.channel.state;\n\n  return previousLast === nextLast;\n};\n\nexport const ChannelPreview = React.memo(\n  UnMemoizedChannelPreview,\n  areEqual,\n) as typeof UnMemoizedChannelPreview;\n"]}